<!DOCTYPE HTML><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="keywords" content="Spring, Sky03"><meta name="description" content="SpringSpring概述Spring 是分层的 Java SE/EE 应用 全栈式（full-stack）轻量级开源框架，以 IoC(Inverse Of Control: 控制反转)和 AOP(Aspect Oriented Prog"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><title>Spring | Sky03&#39;s Blog</title><link rel="icon" type="image/png" href="/medias/logo.png"><link rel="stylesheet" href="/libs/awesome/css/all.css"><link rel="stylesheet" href="/libs/materialize/materialize.min.css"><link rel="stylesheet" href="/libs/aos/aos.css"><link rel="stylesheet" href="/libs/animate/animate.min.css"><link rel="stylesheet" href="/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="/css/matery.css"><link rel="stylesheet" href="/css/my.css"><script src="/libs/jquery/jquery.min.js"></script><link rel="alternate" href="/atom.xml" title="Sky03's Blog" type="application/atom+xml"><link rel="stylesheet" href="/css/prism-material-oceanic.css"><link rel="stylesheet" href="/css/prism-line-numbers.css"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper head-container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="/medias/loading.gif" data-original="/medias/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">Sky03's Blog</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>标签</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>归档</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fas fa-comments" style="zoom:.6"></i> <span>留言板</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>友情链接</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="/medias/loading.gif" data-original="/medias/logo.png" class="logo-img circle responsive-img"><div class="logo-name">Sky03's Blog</div><div class="logo-desc">Never really desperate, only the lost of the soul.</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> 标签</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> 归档</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li><li class="m-nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fa-fw fas fa-comments"></i> Contact</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> 友情链接</a></li></ul></div></div></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(/medias/featureimages/19.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><div class="description center-align post-title">Spring</div></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="/libs/tocbot/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{padding-left:20px}.toc-widget .toc-title{margin:35px 0 15px 0;padding-left:17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px}#toc-content .is-active-link{color:#42b983}#toc-content .is-active-link::before{background-color:#42b983}#floating-toc-btn{position:fixed;right:32px;bottom:155px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/Java/"><span class="chip bg-color">Java</span></a> <a href="/tags/Spring/"><span class="chip bg-color">Spring</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Java/" class="post-category">Java</a> <a href="/categories/Java/Framework/" class="post-category">Framework</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> 发布于:&nbsp;&nbsp; 2019-02-13</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i> 更新于:&nbsp;&nbsp; 2019-05-09</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> 文章字数:&nbsp;&nbsp; 9.3k</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i> 阅读次数:&nbsp;&nbsp;<span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><div class="card-content article-card-content"><div id="articleContent"><h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><h3 id="Spring概述"><a href="#Spring概述" class="headerlink" title="Spring概述"></a>Spring概述</h3><p>Spring 是分层的 Java SE/EE 应用 全栈式（full-stack）轻量级开源框架，以 <code>IoC</code>(Inverse Of Control: 控制反转)和 <code>AOP</code>(Aspect Oriented Programming:面向切面编程)为内核，提供了表现层 Spring MVC 和持久层 Spring JDBC 以及业务层事务管理等众多的企业级应用技术，还能整合开源世界众多 著名的第三方框架和类库，逐渐成为使用最多的 Java EE 企业应用开源框架。</p><h3 id="Spring的发展历程"><a href="#Spring的发展历程" class="headerlink" title="Spring的发展历程"></a>Spring的发展历程</h3><p>1997 年 IBM 提出了 EJB 的思想<br>Spring 诞生于2002，成型与2003，作者是Rod Johnson，他写了两本书</p><ul><li><code>《Expert One-to-One J2EE Desion and Development》</code></li><li><code>《Expert One-to-One J2EE Development without EJB》</code>(2004)</li></ul><p>阐述了 J2EE 开发不使用 EJB 的解决方式(Spring 雏形)<br>2017年9月份发布了Spring的最新版本Spring 5.0通用版(GA) JDK版本要求1.8及以上</p><h3 id="Spring的优势"><a href="#Spring的优势" class="headerlink" title="Spring的优势"></a>Spring的优势</h3><h4 id="方便解耦，简化开发"><a href="#方便解耦，简化开发" class="headerlink" title="方便解耦，简化开发"></a>方便解耦，简化开发</h4><p>通过 Spring 提供的 IoC 容器，可以将对象间的依赖关系交由 Spring 进行控制，避免硬编码所造成的过度程序耦合。用户也不必再为单例模式类、属性文件解析等这些很底层的需求编写代码，可以更专注于上层的应用。</p><h4 id="AOP-编程的支持"><a href="#AOP-编程的支持" class="headerlink" title="AOP 编程的支持"></a>AOP 编程的支持</h4><p>通过 Spring 的 AOP 功能，方便进行面向切面的编程，许多不容易用传统OOP实现的功能可以通过 AOP 轻松应付。</p><h4 id="声明式事务的支持"><a href="#声明式事务的支持" class="headerlink" title="声明式事务的支持"></a>声明式事务的支持</h4><p>可以将我们从单调烦闷的事务管理代码中解脱出来，通过声明式方式灵活的进行事务的管理，提高开发效率和质量。</p><h4 id="方便程序的测试"><a href="#方便程序的测试" class="headerlink" title="方便程序的测试"></a>方便程序的测试</h4><p>可以用非容器依赖的编程方式进行几乎所有的测试工作，测试不再是昂贵的操作，而是随手可做的事情。</p><h4 id="方便集成各种优秀框架"><a href="#方便集成各种优秀框架" class="headerlink" title="方便集成各种优秀框架"></a>方便集成各种优秀框架</h4><p>Spring 可以降低各种框架的使用难度，提供了对各种优秀框架(Struts、Hibernate、Hessian、Quartz等)的直接支持。</p><h4 id="降低-JavaEE-API-的使用难度"><a href="#降低-JavaEE-API-的使用难度" class="headerlink" title="降低 JavaEE API 的使用难度"></a>降低 JavaEE API 的使用难度</h4><p>Spring 对 JavaEE API(如 JDBC、JavaMail、远程调用等)进行了薄薄的封装层，使这些API的使用难度大为降低。</p><h4 id="Spring-源码是经典学习范例"><a href="#Spring-源码是经典学习范例" class="headerlink" title="Spring 源码是经典学习范例"></a>Spring 源码是经典学习范例</h4><p>Spring 的源代码设计精妙、结构清晰、匠心独用，处处体现着大师对 Java 设计模式灵活运用以及对 Java 技术的高深造诣。它的源代码无意是 Java 技术的最佳实践的范例。</p><h3 id="Spring的体系结构"><a href="#Spring的体系结构" class="headerlink" title="Spring的体系结构"></a>Spring的体系结构</h3><p><img src="/medias/loading.gif" data-original="https://sky03-blog-images.oss-cn-beijing.aliyuncs.com/blog-img/spring-overview.png" alt></p><h2 id="IoC的概念及作用"><a href="#IoC的概念及作用" class="headerlink" title="IoC的概念及作用"></a>IoC的概念及作用</h2><h3 id="什么是程序的耦合"><a href="#什么是程序的耦合" class="headerlink" title="什么是程序的耦合"></a>什么是程序的耦合</h3><p><code>耦合性</code>(Coupling)，也叫耦合度，是对模块间关联程度的度量。</p><p>简单来说，耦合就是：程序间的依赖关系。它包括：</p><ul><li>类之间的依赖</li><li>方法间的依赖</li></ul><p>程序间的耦合不可能完全消除，只能降低程序间的依赖关系，这叫做<code>解耦</code></p><h3 id="解决程序耦合的思路"><a href="#解决程序耦合的思路" class="headerlink" title="解决程序耦合的思路"></a>解决程序耦合的思路</h3><p>开发中要做到：<code>编译期不依赖，运行时才依赖</code></p><p>比如：</p><ul><li><p>数据库驱动加载，我们一般都这么写：</p><pre class="line-numbers language-java"><code class="language-java">Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//参数是字符串，利用反射加载的数据库驱动</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>其实注册驱动可以这么写：</p><pre class="line-numbers language-java"><code class="language-java">DriverManager<span class="token punctuation">.</span><span class="token function">registerDriver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>Driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>为什么我们平常都按照上面的写呢？</p><p>因为下面这句带了new关键字，如果数据库驱动文件不在了，程序在编译的时候就通过不了；而上面那句是按照字符串来的，就算数据库驱动文件不在，也可以通过编译，这就降低了程序间的耦合度。</p></li></ul><h3 id="工厂模式解耦"><a href="#工厂模式解耦" class="headerlink" title="工厂模式解耦"></a>工厂模式解耦</h3><p>在我们普通的Servlet、Service、Dao三层架构中，表现层Servlet必须要new一个业务层Service的实现类，而业务层Service也必须要new一个持久层Dao的实现类；这就出现了耦合！解决办法是用工厂模式解耦！</p><h3 id="控制反转（IOC）"><a href="#控制反转（IOC）" class="headerlink" title="控制反转（IOC）"></a>控制反转（IOC）</h3><p><code>控制反转</code>是一种设计思想。</p><p>就是将你设计好的对象交给Spring控制new出来，而不是由你自己直接new，从而达到降低耦合的目的。所以叫做控制反转。</p><h2 id="IOC的使用"><a href="#IOC的使用" class="headerlink" title="IOC的使用"></a>IOC的使用</h2><h3 id="准备spring的开发包"><a href="#准备spring的开发包" class="headerlink" title="准备spring的开发包"></a>准备spring的开发包</h3><p>Spring官网：<a href="https://spring.io/" target="_blank" rel="noopener">https://spring.io/</a></p><p>jar包下载地址：<a href="https://repo.spring.io/release/org/springframework/spring/" target="_blank" rel="noopener">https://repo.spring.io/release/org/springframework/spring/</a></p><h3 id="Spring项目入门"><a href="#Spring项目入门" class="headerlink" title="Spring项目入门"></a>Spring项目入门</h3><ol><li><p>首先创建简单的Servlet、Service、Dao三层架构的接口以及其实现类。</p></li><li><p>创建Spring的配置文件（叫什么都行，一般叫<code>applicationContext.xml</code>），记得导入约束。（idea可以直接new一个自带约束的Spring Config.xml文件）</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    <span class="token comment" spellcheck="true">&lt;!-- id应该是随便写的，当然要能认识，class为bean的全类名 --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xyz.sky03.service.impl.UserServiceImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UserDao<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xyz.sky03.dao.impl.UserDaoImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>获取Spring new的bean对象</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> xyz<span class="token punctuation">.</span>sky03<span class="token punctuation">.</span>servlet<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>ApplicationContext<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span>ClassPathXmlApplicationContext<span class="token punctuation">;</span>
<span class="token keyword">import</span> xyz<span class="token punctuation">.</span>sky03<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>IUserDao<span class="token punctuation">;</span>
<span class="token keyword">import</span> xyz<span class="token punctuation">.</span>sky03<span class="token punctuation">.</span>service<span class="token punctuation">.</span>IUserService<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServlet</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">//1.获取核心容器对象</span>
        ApplicationContext ac<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"bean.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//2.根据id获取Bean对象  以下两种方式都可以</span>
        <span class="token comment" spellcheck="true">//这里没有返回指定类型，所以需要强转类型</span>
        IUserService service <span class="token operator">=</span> <span class="token punctuation">(</span>IUserService<span class="token punctuation">)</span> ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"userService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment" spellcheck="true">//这里第一个参数填配置文件中&lt;bean>的id，因为参数里指定了class，所以可以直接得到对应的类型</span>
        IUserDao dao <span class="token operator">=</span> ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"UserDao"</span><span class="token punctuation">,</span> IUserDao<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ac<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dao<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p>其中：</p><ul><li><p><code>ApplicationContext</code>的三个常用实现类</p><ul><li><code>ClassPathXmlApplicationContext</code>：它可以加载类路径下的配置文件，不在加载不了（常用）</li><li><code>FileSystemXmlApplicationContext</code>：它可以加载磁盘任意路径下的配置文件（必须有访问权限）</li><li><code>AnnotationConfigApplicationContext</code>：它是用于读取注解创建容器的</li></ul></li><li><p>Spring的两种工厂类</p><ul><li><code>BeanFactory</code>：Spring 容器中的顶层接口<br><code>延迟加载</code>，调用getBean的时候，才会生成类的实例；单例对象适用。</li><li><code>ApplicationContext</code>：BeanFactory的子接口。（一般用这个）<br><code>立即加载</code>，加载配置文件的时候，就会将Spring管理的类全部实例化；多例对象适用；它还会根据创建的对象是多例还是单例，自动选择立即加载还是延迟加载。</li></ul></li><li><p>关于配置文件中 <code>&lt;bean&gt;</code>标签用id和name的区别</p><ul><li>id ：使用了 <code>唯一约束</code>，里面 <code>不能有特殊字符</code></li><li>name ：<code>没有唯一约束</code>（理论上可以出现重复，但实际开发中不能出现）<ul><li>命名上 <code>可以出现特殊字符</code></li></ul></li><li>另外Spring和Struts1整合的时候：<ul><li>Struts1的id或name前面必须加个”/“，但是Spring的id前面是不能加”/“的</li><li>所以要用name！ like this：<code>&lt;bean name=&quot;/a1&quot; class=&quot;...&quot;&gt;</code></li></ul></li></ul></li></ul><h3 id="IOC中bean标签和管理对象细节"><a href="#IOC中bean标签和管理对象细节" class="headerlink" title="IOC中bean标签和管理对象细节"></a>IOC中bean标签和管理对象细节</h3><h4 id="创建bean的三种方式"><a href="#创建bean的三种方式" class="headerlink" title="创建bean的三种方式"></a>创建bean的三种方式</h4><ol><li><p>使用默认构造函数创建。</p><p>在spring的配置文件中使用bean标签，配以id和class属性之后，且没有其他属性和标签时。采用的就是默认构造函数创建bean对象，此时如果类中没有默认构造函数，则对象无法创建。</p><pre class="line-numbers language-xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xyz.sky03.service.impl.UserServiceImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>使用普通工厂中的方法创建对象（使用某个类中的方法创建对象，并存入spring容器）</p><pre class="line-numbers language-xml"><code class="language-xml"> <span class="token comment" spellcheck="true">&lt;!-- 此bean有创建UserService的方法 --></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>instanceFactory<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xyz.sky03.factory.InstanceFactory<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>
 <span class="token comment" spellcheck="true">&lt;!-- 此bean用来调用上一个bean的创建UserService的方法--></span>
 <span class="token comment" spellcheck="true">&lt;!-- factory-bean指定从哪个bean来创建UserService，factory-method：从bean的哪个方法得到UserService对象--></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">factory-bean</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>instanceFactory<span class="token punctuation">"</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>getUserService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>使用工厂中的静态方法创建对象（使用某个类中的静态方法创建对象，并存入spring容器)</p><pre class="line-numbers language-xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xyz.sky03.factory.StaticFactory<span class="token punctuation">"</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>getUserService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h4 id="bean对象的作用范围调整"><a href="#bean对象的作用范围调整" class="headerlink" title="bean对象的作用范围调整"></a>bean对象的作用范围调整</h4><ul><li>方法：使用bean标签的<code>scope</code>属性</li><li>作用：用于指定bean的作用范围</li><li>取值：常用的就是单例和多例<ul><li><code>singleton</code>：单例的（默认值）</li><li><code>prototype</code>：多例的</li><li><code>request</code>：作用于web应用的请求范围</li><li><code>session</code>：作用于web应用的会话范围</li><li><code>global-session</code>：作用于集群环境的会话（全局会划范围），当不是集群环境时，它就相当于<code>session</code>。</li></ul></li></ul><h4 id="bean对象的生命周期"><a href="#bean对象的生命周期" class="headerlink" title="bean对象的生命周期"></a>bean对象的生命周期</h4><ul><li>单例对象<ul><li>出生：当容器创建时对象出生</li><li>活着：只要容器还在，对象就一直活着</li><li>死亡：容器销毁，对象死亡</li><li>总结：单例对象的生命周期和容器相同</li></ul></li><li>多例对象<ul><li>出生：当我们使用对象时，Spring为我们创建</li><li>活着：对象只要是在使用过程中，就一直活着</li><li>死亡：当对象长时间不用，且没有别的对象引用时，由Java的垃圾回收器回收</li></ul></li><li>手动配置bean的生命周期<ul><li>在bean标签里有两个属性<ul><li><code>init-method</code>：用于指定Bean被初始化的时候执行的方法</li><li><code>destroy-method</code>：用于指定Bean被销毁的时候执行的方法<ul><li>Bean一般是单例创建，工厂关闭，所以会跳过destroy-method指定的方法</li></ul></li></ul></li></ul></li></ul><h2 id="依赖注入DI"><a href="#依赖注入DI" class="headerlink" title="依赖注入DI"></a>依赖注入DI</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>依赖注入（Dependency Injection）就是bean实体类构造函数为有参构造函数，这时候为了能创建bean对象，就需要对构造函数注入参数！</p><h3 id="依赖注入的方式"><a href="#依赖注入的方式" class="headerlink" title="依赖注入的方式"></a>依赖注入的方式</h3><h4 id="使用构造函数注入"><a href="#使用构造函数注入" class="headerlink" title="使用构造函数注入"></a>使用构造函数注入</h4><ul><li><p>使用<code>标签</code>：constructor-arg</p></li><li><p>标签使用的位置：bean标签的内部</p></li><li><p>标签的属性：</p><ul><li><p>type：根据要注入的数据的数据类型，来注入构造函数中对应的某个或某些参数；</p><ul><li>也就是说如果构造函数中有多个相同的数据类型，此属性就不适用了</li></ul></li><li><p>index：索引，指定要注入的属性给构造函数中对应索引的位置 （从0开始）</p></li><li><p>name：给构造函数中的指定名称的参数赋值 （常用）</p><p>==========以上三个用于指定给构造函数中哪个参数赋值=========</p></li><li><p>value：用于提供基本类型和String类型的数据</p><ul><li>如：日期类型，就不能用value来注入</li></ul></li><li><p>ref：用于指定其他的bean类型数据。它指的就是在Spring的IOC核心容器中出现过的bean对象</p></li></ul><p>示例：</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xyz.sky03.service.impl.UserServiceImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>泰斯特<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor-arg</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>18<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor-arg</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>birthday<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>now<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor-arg</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

<span class="token comment" spellcheck="true">&lt;!-- 配置一个日期对象 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>now<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.util.Date<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>优势：</p></li><li><p>保证一些必要的属性在Bean实例化时就得到设置，并且确保了Bean实例在实例化后就可以使用。</p></li><li><p>弊端：</p></li><li><p>改变了bean对象的实例化方式，使我们在创建对象时，即使用不到这些数据，也必须提供。</p></li></ul><h4 id="使用属性的Setter方法注入-（常用）"><a href="#使用属性的Setter方法注入-（常用）" class="headerlink" title="使用属性的Setter方法注入 （常用）"></a>使用属性的Setter方法注入 （常用）</h4><ul><li>标签：property</li><li>位置：bean标签的子标签</li><li>要求：<ul><li>要创建的bean要有其各个属性的Setter方法（不需要Getter方法）<ul><li>Spring只会检查Bean中是否有对应的Setter方法，至于Bean中是否有对应的属性变量则不做要求。</li></ul></li><li>提供一个无参的构造方法（必须！）<ul><li>假设bean类中显示定义了一个带参的构造函数，如public Bean(String test)，则需要同时提供一个默认构造函数public Bean()，否则使用属性注入时将抛出异常。</li></ul></li></ul></li><li>标签的属性<ul><li>name：用于指定注入时所调用的Setter方法名称，或其他bean的id</li><li>value：用于提供基本类型和String类型的数据</li><li>ref：用于指定其他的bean类型数据。它指的就是在Spring的IOC核心容器中出现过的bean对象</li></ul></li><li>原理：<ul><li>Spring先调用Bean的默认构造函数实例化Bean对象，然后通过反射的方式调用Setter方法注入属性值。</li></ul></li></ul><h4 id="复杂类型的注入（集合类型）"><a href="#复杂类型的注入（集合类型）" class="headerlink" title="复杂类型的注入（集合类型）"></a>复杂类型的注入（集合类型）</h4><ul><li>集合类型的参数 无论是value 还是ref 都不能注入！</li><li>正确的姿势是：</li><li>集合分两个结构 <code>List</code> 和 <code>Map</code></li><li><code>List</code> 结构的集合在Setter属性注入的方式基础上，在property标签的内部使用以下标签<ul><li><code>list</code> 、<code>array</code> 、<code>set</code></li></ul></li><li><code>Map</code> 结构的集合，同理，在property标签的内部使用以下标签<ul><li><code>map</code> 、<code>props</code> 、</li></ul></li></ul><h4 id="使用注解注入"><a href="#使用注解注入" class="headerlink" title="使用注解注入"></a>使用注解注入</h4><h2 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h2><h3 id="创建bean对象"><a href="#创建bean对象" class="headerlink" title="创建bean对象"></a>创建bean对象</h3><ol><li><p>先在主配置文件上加入 <code>context</code> 的约束，再配置一个<code>&lt;context:component-scan&gt;</code>的标签，还有base-package的属性，用于告知Spring创建容器时要扫描的包（去找带<code>@Component</code>的注解）</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xyz.sky03<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">context:</span>component-scan</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>在bean的实体类上面加 <code>@Component</code> 注解，bean的id默认为bean的首字母小写的类名，也可以加参数指定id</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"userService"</span><span class="token punctuation">)</span>
或
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"userService"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//只有value属性时，可以省略不写</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>其他注解：</p><p>以下三个注解的作用和 <code>@Component</code> 一样，它们是Spring为我们提供的三层架构使用的注解，使我们的三层对象更加清晰</p><ul><li><code>@Controller</code> ：一般用于表现层</li><li><code>@Service</code> ：一般用于业务层</li><li><code>@Repository</code> ：一般用于持久层</li></ul></li></ol><h3 id="注入数据"><a href="#注入数据" class="headerlink" title="注入数据"></a>注入数据</h3><ul><li><p><code>@Autowired</code></p><ul><li>作用：自动按照类型注入。只要Spring容器中有唯一的一个bean对象类型和要注入的变量类型匹配（包括其实现类），就可以注入成功！</li><li>但是当IOC容器有多个相同类型的bean时，Spring会自动根据要创建的对象名和IOC容器中的id匹配。</li><li>如果IOC容器中没有任何bean的类型和要注入的变量类型匹配，则会报错。</li><li>注解的位置：很多地方都能写。一般都是类的上面，或方法的上面。</li><li>不需要set方法。</li></ul></li><li><p><code>@Qualifier</code></p><ul><li><p>作用：在<code>@Autowired</code>的基础上再按照名称注入。</p></li><li><p>属性：value，用来指定注入的名称。</p></li><li><p>位置：在给类成员注入时无法单独使用，必须在前面加上<code>@Autowired</code> ，否则报错！</p></li><li><p>在给方法参数注入时可以单独使用</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"userDao"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> IUserDao userDao<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p><code>@Resource</code></p><ul><li>作用：直接按照bean的id注入。它可以独立使用</li><li>属性：name，用来指定bean的id</li></ul></li><li><p>以上三个注入都只能注入bean类型的数据，而基本类型和String类型无法使用上述注解实现。另外，集合类型的注入只能通过XML来实现。</p></li><li><p><code>@Value</code></p><ul><li>作用：注入基本类型和String类型的数据</li><li>属性：value，用于指定数据的值。它可以使用Spring中SpEL(也就是spring的el表达式）</li><li>SpEL的写法：${表达式}</li></ul></li></ul><h3 id="改变作用范围"><a href="#改变作用范围" class="headerlink" title="改变作用范围"></a>改变作用范围</h3><ul><li><code>@Scope</code><ul><li>作用：用于指定bean的作用范围</li><li>属性：value，指定范围的取值。常用取值：<code>singleton</code> <code>prototype</code> （单例和多例）</li><li>位置：bean类的上面</li></ul></li></ul><h3 id="生命周期相关（了解）"><a href="#生命周期相关（了解）" class="headerlink" title="生命周期相关（了解）"></a>生命周期相关（了解）</h3><ul><li><code>@PreDestroy</code><ul><li>作用：用于指定销毁方法</li><li>位置 ：在销毁方法的上面</li><li>另外，获取容器对象的时候，如果使用的是<code>ApplicationContext</code>，会跳过销毁方法的执行，必须使用<code>ClassPathXmlApplicationContext</code></li><li>还有，Spring是不负责多例的销毁！</li></ul></li><li><code>@PostConstruct</code><ul><li>作用：用于指定初始化方法</li><li>位置：在初始化方法的上面</li></ul></li></ul><h2 id="新注解"><a href="#新注解" class="headerlink" title="新注解"></a>新注解</h2><blockquote><p>由于以上注解只能用于注解我们自己写的类，脱离不了配置文件，所以采用新注解</p></blockquote><p>新建一个名为<code>config.SpringConfiguration</code>的类（叫什么都行），在其中配置一下注解：</p><ul><li><p><code>@Configuration</code></p><ul><li><p>作用：指定当前类为一个配置类</p></li><li><p>细节：当配置类作为<code>AnnotationConfigApplicationContext</code>对象创建的参数时，该注解可以不写。可以用class文件直接指定配置类。</p><pre class="line-numbers language-java"><code class="language-java">ApplicationContext ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span>SpringConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>位置：目标类的上方</p></li></ul></li><li><p><code>@ComponentScan</code></p><ul><li>作用：用于通过注解指定Spring在创建容器时要扫描的包</li><li>属性：value和basePackages，二者作用一样，都是用于指定创建容器时要扫描的包。</li><li>相当于：XML中的 <code>&lt;context:component-scan base-package=&quot;xyz.sky03&quot;&gt;&lt;/context:component-scan&gt;</code></li><li>位置：配置类的上方</li></ul></li><li><p><code>@Bean</code></p><ul><li>作用：用于把当前方法的返回值作为bean对象存入spring的ioc容器中</li><li>属性：name，用于指定bean的id。当不写时，默认值是当前方法的名称</li><li>细节：当我们使用注解配置方法时，如果方法有参数，spring框架会去容器中查找有没有可用的bean对象。查找的方式和Autowired注解的作用是一样的</li></ul></li><li><p><code>@Import</code></p><ul><li>作用：用于导入其他的配置类</li><li>属性：value，用于指定其他配置类的字节码。</li><li>细节：带<code>@Import</code>注解的类就是父配置类（主配置类），而被导入的类都是子配置类（副配置类）</li></ul></li><li><p><code>@PropertySource</code></p><ul><li><p>作用：用于指定properties文件的位置</p></li><li><p>属性：value，指定文件的名称和路径。</p><ul><li>其中关键字：classpath：表示类路径下</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">"classpath:jdbcConfig.properties"</span><span class="token punctuation">)</span>
或
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">"classpath:xyz/sky03/jdbcConfig.properties"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h2 id="Spring整合Junit测试"><a href="#Spring整合Junit测试" class="headerlink" title="Spring整合Junit测试"></a>Spring整合Junit测试</h2><ol><li><p>首先要明白：</p><ol><li>应用程序的入口：main方法</li><li>junit单元测试中，没有main方法也能执行<ul><li>junit集成了一个main方法</li><li>该方法就会判断当前测试类中哪些方法有 @Test注解</li><li>junit就让有Test注解的方法执行</li></ul></li><li>junit不会管我们是否采用spring框架<ul><li>在执行测试方法时，junit根本不知道我们是不是使用了spring框架</li><li>所以也就不会为我们读取配置文件/配置类创建spring核心容器</li></ul></li><li>由以上三点可知<ul><li>当测试方法执行时，没有Ioc容器，就算写了@Autowired注解，也无法实现注入</li></ul></li></ol></li><li><p>导入Spring整合Junit的jar包或maven坐标 <code>spring-test</code></p></li><li><p>Junit提供了一个注解 <code>@Runwith</code>，可以把原有的main方法替换成spring提供的main方法</p><ul><li><code>@RunWith(SpringJUnit4ClassRunner.class)</code></li><li>参数为字节码文件</li></ul></li><li><p><code>@ContextConfiguration</code> ，用于告知spring的运行器，spring和ioc创建是基于xml还是注解的，并且说明位置。</p><ul><li><p>属性：</p><ul><li><p>locations：指定xml文件的位置，加上classpath关键字，表示在类路径下</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token string">"classpath:bean.xml"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>classes：指定注解类所在地位置</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> SpringConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li></ul></li><li><p>注意：使用Spring 5.x版本的时候，要求Junit的版本必须是4.12及以上，否则执行以上内容会报错</p></li></ol><h2 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h2><ul><li>特点：字节码随用随创建，随用随加载</li><li>作用：不修改源码的基础上对方法增强</li><li>分类：<ul><li>基于接口的动态代理</li><li>基于子类的动态代理</li></ul></li></ul><h3 id="基于接口的动态代理"><a href="#基于接口的动态代理" class="headerlink" title="基于接口的动态代理"></a>基于接口的动态代理</h3><ul><li><p>提供者：JDK官方的Proxy类</p></li><li><p>要求：被代理类最少实现一个接口，如果没有则不能使用</p></li><li><p>如何创建：使用Proxy类中的newProxyInstance方法</p></li><li><p>newProxyInstance方法参数：</p><ul><li><code>ClassLoader</code>：类加载器<ul><li>它是用于加载代理对象字节码的。和被代理对象使用相同的类加载器。</li><li>固定写法：代理谁就写谁的 <code>getClassLoader()</code></li></ul></li><li><code>Class[]</code>：字节码数组<ul><li>它是用于让代理对象和被代理对象有相同方法。实现相同的接口</li><li>固定写法：代理谁就写谁的 <code>getInterfaces()</code></li></ul></li><li><code>InvocationHandler</code>：用于提供增强的代码<ul><li>用来写如何代理的代码。我们一般都是些一个该接口的实现类，通常情况下都是匿名内部类，但不是必须的。</li><li>此接口的实现类都是谁用谁写。</li></ul></li></ul></li><li><p>示例：</p><pre class="line-numbers language-java"><code class="language-java">IProducer proxyProducer <span class="token operator">=</span> <span class="token punctuation">(</span>IProducer<span class="token punctuation">)</span> Proxy<span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>producer<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        producer<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">/**
             * 作用：执行被代理对象的任何接口方法都会经过该方法
             * 方法参数的含义
             * @param proxy   代理对象的引用
             * @param method  当前执行的方法
             * @param args    当前执行方法所需的参数
             * @return        和被代理对象方法有相同的返回值
             * @throws Throwable
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> Object <span class="token function">invoke</span><span class="token punctuation">(</span>Object proxy<span class="token punctuation">,</span> Method method<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">//提供增强的代码</span>
                Object returnValue <span class="token operator">=</span> null<span class="token punctuation">;</span>

                <span class="token comment" spellcheck="true">//1.获取方法执行的参数</span>
                Float money <span class="token operator">=</span> <span class="token punctuation">(</span>Float<span class="token punctuation">)</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">//2.判断当前方法是不是销售</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"saleProduct"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    returnValue <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>producer<span class="token punctuation">,</span> money<span class="token operator">*</span><span class="token number">0.8f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> returnValue<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="基于子类的动态代理"><a href="#基于子类的动态代理" class="headerlink" title="基于子类的动态代理"></a>基于子类的动态代理</h3><p>基于子类的动态代理是需要jar包的支持 <code>cglib.jar</code> 和 <code>asm.jar</code></p><ul><li><p>提供者：第三方 <code>cglib</code>库的 Enhancer类</p></li><li><p>如何创建：使用Enhancer类中的create方法</p></li><li><p>要求：被代理类不能是 最终类（不能创建子类）</p></li><li><p>create方法参数：</p><ul><li>Class：字节码<ul><li>用于指定被代理对象的字节码</li></ul></li><li>Callback：用于提供增强代码<ul><li>我们一般写的都是该接口的子接口实现类：MethodInterceptor</li></ul></li></ul></li><li><p>示例：</p><pre class="line-numbers language-java"><code class="language-java">Producer cglibProducer <span class="token operator">=</span> <span class="token punctuation">(</span>Producer<span class="token punctuation">)</span>Enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>producer<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MethodInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">/**
     * 执行北地阿里对象的任何方法都会经过该方法
     * @param proxy
     * @param method
     * @param args
     *    以上三个参数和基于接口的动态代理中invoke方法的参数是一样的
     * @param methodProxy ：当前执行方法的代理对象
     * @return
     * @throws Throwable
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Object <span class="token function">intercept</span><span class="token punctuation">(</span>Object proxy<span class="token punctuation">,</span> Method method<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> MethodProxy methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//提供增强的代码</span>
        Object returnValue <span class="token operator">=</span> null<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//1.获取方法执行的参数</span>
        Float money <span class="token operator">=</span> <span class="token punctuation">(</span>Float<span class="token punctuation">)</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//2.判断当前方法是不是销售</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"saleProduct"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            returnValue <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>producer<span class="token punctuation">,</span> money<span class="token operator">*</span><span class="token number">0.8f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> returnValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cglibProducer<span class="token punctuation">.</span><span class="token function">saleProduct</span><span class="token punctuation">(</span><span class="token number">12000f</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="Spring的AOP"><a href="#Spring的AOP" class="headerlink" title="Spring的AOP"></a>Spring的AOP</h2><h3 id="AOP概念"><a href="#AOP概念" class="headerlink" title="AOP概念"></a>AOP概念</h3><p><code>AOP</code>:全称是 Aspect Oriented Programming 即:<code>面向切面编程</code>。</p><p>简单的说它就是把我们程序重复的代码抽取出来，在需要执行的时候，使用动态代理的技术，在不修改源码的基础上，对我们的已有方法进行增强。</p><h3 id="AOP作用"><a href="#AOP作用" class="headerlink" title="AOP作用"></a>AOP作用</h3><ol><li><strong>AOP主要作用就是横切关注点的分离和织入</strong>，横切关注点可能包含很多，比如非业务的：日志、事务处理、缓存、性能统计、权限控制等等这些非业务的基础功能；也可以关注业务</li><li>完善oop</li><li>降低组件和模块之间的耦合性</li><li>使系统容易扩展</li><li>而且由于关注点分离从而可以获得组件的更好复用</li></ol><h3 id="AOP发展历程"><a href="#AOP发展历程" class="headerlink" title="AOP发展历程"></a>AOP发展历程</h3><blockquote><p><strong>AOP思想最早由AOP联盟组织提出。Spring是使用这种思想的最好架构。</strong></p></blockquote><ul><li>Spring的AOP有自己的实现方式（非常繁琐），后来有个很AOP框架叫AspectJ，Spring就将其引入到自己的框架中了，弃用了自己的实现方式。</li></ul><h3 id="AOP中的细节"><a href="#AOP中的细节" class="headerlink" title="AOP中的细节"></a>AOP中的细节</h3><h4 id="AOP的底层实现方式"><a href="#AOP的底层实现方式" class="headerlink" title="AOP的底层实现方式"></a>AOP的底层实现方式</h4><blockquote><p><strong>使用动态代理技术</strong></p></blockquote><h4 id="关于代理方式的选择"><a href="#关于代理方式的选择" class="headerlink" title="关于代理方式的选择"></a>关于代理方式的选择</h4><blockquote><p><strong>在 spring 中，框架会根据目标类是否实现了接口来决定采用哪种动态代理的方式。</strong>（基于接口，还是基于子类）</p></blockquote><h4 id="AOP相关术语"><a href="#AOP相关术语" class="headerlink" title="AOP相关术语"></a>AOP相关术语</h4><ul><li>连接点（Joinpoint）:<ul><li>所谓连接点就是可以被增强的方法。</li></ul></li><li>切入点（Pointcut）:<ul><li>被增强的方法就叫做切入点。</li></ul></li><li>总结<ul><li>所有的切入点都是连接点，所有的连接点被增强后就是切入点！</li></ul></li><li>通知/增强（Advice）:<ul><li>所谓通知是指拦截到 Joinpoint 之后所要做的事情就是通知。</li><li>通知的类型:前置通知,后置通知,异常通知,最终通知,环绕通知。<ul><li>前置通知：位于invoke方法之前</li><li>后置通知：位于invoke方法之后</li><li>异常通知：在catch里面</li><li>最终通知：在finally里面</li><li>环绕通知：整个的invoke方法就是环绕通知。</li></ul></li></ul></li><li>引介（Introduction）:<ul><li>引介是一种特殊的通知在不修改类代码的前提下, Introduction 可以在运行期为类动态地添加一些方法或 Field。（类层面上的增强）</li></ul></li><li>目标对象（Target）:<ul><li>被代理的对象。</li></ul></li><li>织入（Weaving）:<ul><li>是指把增强应用到目标对象来创建新的代理对象的过程。</li><li>spring 采用动态代理织入，而 AspectJ 采用编译期织入和类装载期织入。</li></ul></li><li>代理（Proxy）:<ul><li>一个类被 AOP 织入增强后，就产生一个结果代理类。</li></ul></li><li>切面（Aspect）:<ul><li>是多个切入点和多个通知(引介)的结合。</li></ul></li></ul><h3 id="AOP入门"><a href="#AOP入门" class="headerlink" title="AOP入门"></a>AOP入门</h3><h4 id="基于XML的AOP配置"><a href="#基于XML的AOP配置" class="headerlink" title="基于XML的AOP配置"></a>基于XML的AOP配置</h4><h5 id="四个通知的配置及切入点表达式配置"><a href="#四个通知的配置及切入点表达式配置" class="headerlink" title="四个通知的配置及切入点表达式配置"></a>四个通知的配置及切入点表达式配置</h5><ul><li><p><code>&lt;aop:config&gt;</code> ：表示AOP的配置，所有AOP相关配置都在其内部</p></li><li><p><code>&lt;aop:aspect&gt;</code> ：表示配置一个切面</p><ul><li>位置：在 <code>&lt;aop:config&gt;</code> 的内部</li><li>属性: <code>id</code> ：是给切面提供的一个唯一标识</li><li>属性: <code>ref</code> ：是指定切面类或通知类bean的id</li></ul></li><li><p><code>&lt;aop:before&gt;</code> ：表示配置一个前置通知</p><ul><li><p>位置：在 <code>&lt;aop:aspect&gt;</code> 的内部</p></li><li><p>属性: <code>method</code> ：用于指定通知中的哪个方法为前置通知！</p></li><li><p>属性: <code>pointcut</code> ：用于指定 <code>切入点表达式</code>，该表达式的含义指的是对业务层中哪些方法增强</p></li><li><p><code>切入点表达式</code> 的写法：</p><ul><li><p>关键字：<code>execution(表达式)</code></p></li><li><p>表达式：</p><ul><li><code>访问修饰符 返回值 包名.包名.包名...类名.方法名(参数列表)</code></li></ul></li><li><p>标准的表达式写法：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> xyz<span class="token punctuation">.</span>sky03<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>UserServiceImpl<span class="token punctuation">.</span><span class="token function">saveUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>其中：</p><ul><li><p>访问修饰符可以省略</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">void</span> xyz<span class="token punctuation">.</span>sky03<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>UserServiceImpl<span class="token punctuation">.</span><span class="token function">saveUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>返回值可以使用通配符，表示任意返回值</p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> xyz<span class="token punctuation">.</span>sky03<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>UserServiceImpl<span class="token punctuation">.</span><span class="token function">saveUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>包名可以使用通配符，表示任意包。但是有几级包，就需要写几个 <code>*.</code></p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">.</span>UserServiceImpl<span class="token punctuation">.</span><span class="token function">saveUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>包名可以使用 <code>..</code> 表示当前包及其子包</p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span>UserServiceImpl<span class="token punctuation">.</span><span class="token function">saveUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>类名和方法名都可以使用 <code>*</code> 来实现通配</p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li></ul></li></ul></li><li><p>表达式的参数列表</p><ul><li>可以直接写的数据类型：<ul><li>基本类型直接写名称 int</li><li>引用类型写包名.类名的方式 java.lang.String</li><li>可以使用通配符表示任意类型，但是必须有参数</li><li>可以使用<code>..</code>表示有无参数均可，有参数可以是任意类型</li></ul></li></ul></li><li><p>全通配写法：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>实际业务开发中切入点表达式的通常写法：</p><ul><li>切到业务层实现类下的所有方法</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> xyz<span class="token punctuation">.</span>sky03<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li><li><p><code>&lt;aop:after-returning&gt;</code> ：后置通知，它和异常通知永远只能执行一个。</p><ul><li>它也有 <code>method</code> 和 <code>pointcut</code> 属性，用法和 <code>&lt;aop:before&gt;</code> 的属性一样</li></ul></li><li><p><code>&lt;aop:after-throwing&gt;</code> ：异常通知，它和后置通知只能执行一个。（要么try，要么catch）</p></li><li><p>它也有 <code>method</code> 和 <code>pointcut</code> 属性，用法和 <code>&lt;aop:before&gt;</code> 的属性一样</p></li><li><p><code>&lt;aop:after&gt;</code> ：最终通知</p></li><li><p>它也有 <code>method</code> 和 <code>pointcut</code> 属性，用法和 <code>&lt;aop:before&gt;</code> 的属性一样</p></li></ul><h5 id="切入点表达式的通用写法"><a href="#切入点表达式的通用写法" class="headerlink" title="切入点表达式的通用写法"></a>切入点表达式的通用写法</h5><ul><li><code>&lt;aop:pointcut&gt;</code> 用于配置切入点表达式<ul><li>属性 <code>id</code> ：用于指定表达式的唯一标识。</li><li>属性 <code>expression</code> ：用于指定表达式内容</li><li>注意：当此标签在 <code>&lt;aop:aspect&gt;</code> 内部时，只能在当前切面使用（当前<code>&lt;aop:aspect&gt;</code>标签内）；<br>如果此标签配置在 <code>&lt;aop:aspect&gt;</code> 外部时（必须是在<code>&lt;aop:aspect&gt;</code> 前面），所有切面都可以使用</li></ul></li></ul><h6 id="以上四个通知还有一个属性叫-pointcut-ref"><a href="#以上四个通知还有一个属性叫-pointcut-ref" class="headerlink" title="以上四个通知还有一个属性叫 pointcut-ref"></a>以上四个通知还有一个属性叫 <code>pointcut-ref</code></h6><ul><li>用于指定切入点表达式的<code>id</code></li></ul><h5 id="环绕通知"><a href="#环绕通知" class="headerlink" title="环绕通知"></a>环绕通知</h5><ul><li><code>&lt;aop:around&gt;</code><ul><li>属性 <code>method</code> ：指定方法</li><li>属性 <code>pointcut-ref</code> ：指定切入点表达式的id</li></ul></li><li>Spring框架提供一个接口：<code>ProceedingJoinPoint</code>。该接口有一个方法<code>proceed()</code>，此方法就相当于调用切入点方法。而如果不配置该方法，就会只执行通知方法，不执行切入点方法。</li><li>它是spring框架为我们提供的一种可以在代码中手动控制增强方法何时执行的方式。</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> Object <span class="token function">aroundPringLog</span><span class="token punctuation">(</span>ProceedingJoinPoint pjp<span class="token punctuation">)</span><span class="token punctuation">{</span>
    Object rtValue <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//得到方法执行所需的参数</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Logger类中的aroundPringLog方法开始记录日志了。。。前置"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        rtValue <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//明确调用业务层方法（切入点方法）</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Logger类中的aroundPringLog方法开始记录日志了。。。后置"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> rtValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span><span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Logger类中的aroundPringLog方法开始记录日志了。。。异常"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Logger类中的aroundPringLog方法开始记录日志了。。。最终"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="基于注解的AOP配置"><a href="#基于注解的AOP配置" class="headerlink" title="基于注解的AOP配置"></a>基于注解的AOP配置</h4><ol><li><p>首先还是在配置文件中加入注解的约束context</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 配置spring创建容器时要扫描的包--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xyz.sky03<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">context:</span>component-scan</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>然后在配置文件中开启注解AOP的支持</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 配置spring开启注解AOP的支持 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>配置注解</p><ul><li><p><code>@Aspect</code> ：表示当前类是一个切面类</p><ul><li>位置：在类名的上方</li></ul></li><li><p><code>@Pointcut</code> ：来指定切入点表达式</p><ul><li>位置：在一个方法上</li><li>其id为：该方法的<code>方法名()</code>，一定要带括号，否则报错！</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(* xyz.sky03.service.impl.*.*(..))"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>@Before</code> ：前置通知</p><ul><li>位置：前置通知方法上方</li><li>参数：为切入点id，一般为方法名，记得带上方法后的括号</li><li>Junit也有<code>@Before</code>，具体适用的哪个，得看导包</li></ul></li><li><p><code>@AfterReturning</code> ：后置通知</p><ul><li>位置：后置通知方法的上方</li><li>参数：为切入点id，记得带上括号</li></ul></li><li><p><code>@AfterThrowing</code> ：异常通知</p><ul><li>位置：异常通知方法的上方</li><li>参数：为切入点id，记得带上括号</li></ul></li><li><p><code>@After</code> ：最终通知</p><ul><li>位置：最终通知方法的上方</li><li>参数：为切入点id，记得带上括号</li></ul></li><li><p><code>@Around</code> ：环绕通知</p><ul><li>位置：环绕通知方法上方</li><li>参数：为切入点id，记得带上括号</li></ul></li><li><p><code>@EnableAspectJAutoProxy</code> ：注解方式开启AOP支持</p><ul><li><p>相当于</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li></ul></li></ol><h2 id="JdbcDaoSupport类"><a href="#JdbcDaoSupport类" class="headerlink" title="JdbcDaoSupport类"></a>JdbcDaoSupport类</h2><blockquote><p><strong>此类是解决SpringTemplate在多个Dao中创建多个SpringTemplate对象的类</strong></p></blockquote><p>具体方法：</p><ul><li>Dao实现类继承<code>JdbcDaoSupport</code>类</li><li>向Dao实现类中注入 <code>DataSource对象</code><ul><li>Dao实现类的父类，也就是<code>JdbcDaoSupport</code>有<code>DataSource对象</code>参数</li></ul></li><li>不用new SpringTemplate对象，直接使用父类的方法<code>super.getJdbcTemplate()</code>，得到SpringTemplate对象</li><li>执行增删改查业务</li><li>使用注解的时候不能使用此类</li></ul><h2 id="AOP的声明式事务"><a href="#AOP的声明式事务" class="headerlink" title="AOP的声明式事务"></a>AOP的声明式事务</h2><h3 id="基于XML"><a href="#基于XML" class="headerlink" title="基于XML"></a>基于XML</h3><blockquote><p>持久层使用的是JdbcTemplate</p></blockquote><ol><li><p>导入AOP和事务的约束</p><pre class="line-numbers language-xml"><code class="language-xml"> <span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/aop<span class="token punctuation">"</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/tx<span class="token punctuation">"</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>
         http://www.springframework.org/schema/beans
         http://www.springframework.org/schema/beans/spring-beans.xsd
         http://www.springframework.org/schema/tx
         http://www.springframework.org/schema/tx/spring-tx.xsd
         http://www.springframework.org/schema/aop
         http://www.springframework.org/schema/aop/spring-aop.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置service和dao以及DataSource的bean</p><pre class="line-numbers language-xml"><code class="language-xml"> <span class="token comment" spellcheck="true">&lt;!-- 配置Service --></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>accountService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xyz.sky03.service.impl.AccountServiceImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     <span class="token comment" spellcheck="true">&lt;!-- 注入dao --></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>accountDao<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>accountDao<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

 <span class="token comment" spellcheck="true">&lt;!--配置Dao对象--></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>accountDao<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xyz.sky03.dao.impl.AccountDaoImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     <span class="token comment" spellcheck="true">&lt;!--注入数据源--></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>datasource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

 <span class="token comment" spellcheck="true">&lt;!--配置数据源的bean--></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>datasource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.springframework.jdbc.datasource.DriverManagerDataSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jdbc:mysql:///eesy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>driverClassName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mysql.jdbc.Driver<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>admin<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置声明式事务</p><ul><li><p>配置事务管理器</p><ul><li>注意：<strong>事务管理器需要注入 <code>DataSource</code> 对象</strong></li></ul><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 配置事务管理器 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置事物的通知</p><ul><li>使用<code>&lt;tx:advice&gt;</code> 标签来配置事务通知</li><li>属性 <code>id</code>：事务通知的唯一标识</li><li>属性 <code>transaction-manager</code>：给事务通知提供一个事务管理器引用</li></ul><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 配置事务的通知--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>txAdvice<span class="token punctuation">"</span></span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>配置AOP中的通用切入点表达式</p></li><li><p>建立事务通知和切入点表达式的对应关系</p><ul><li>属性 <code>advice-ref</code>：指定哪个事务通知</li><li>属性 <code>pointcut-ref</code>：指定切入点表达式</li></ul><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 配置aop--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- 配置切入点表达式--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pt1<span class="token punctuation">"</span></span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>execution(* xyz.sky03.service.impl.*.*(..))<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>pointcut</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--建立切入点表达式和事务通知的对应关系 --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>advisor</span> <span class="token attr-name">advice-ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>txAdvice<span class="token punctuation">"</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pt1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>advisor</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置事务的属性</p><ul><li>标签：<code>&lt;tx:attributes&gt;</code>、<code>&lt;tx:method&gt;</code> （单标签，貌似单双无所谓）</li><li>位置：<code>&lt;tx:attributes&gt;</code>在<code>&lt;tx:advice&gt;</code> 标签的内部、<code>&lt;tx:method&gt;</code> 在 <code>&lt;tx:attributes&gt;</code>的内部</li><li>在<code>&lt;tx:attributes&gt;</code>的内部可以配置多个事务</li><li><code>&lt;tx:method&gt;</code>标签属性：<ul><li><code>name</code>：指定对哪个方法配置事务，一般会有很多方法都需要事务，这时候可以用通配符 <code>*</code> 或者 <code>find*</code></li><li><code>isolation</code>：用于指定事务的隔离级别。默认值是DEFAULT，表示使用数据库的默认隔离级别。</li><li><code>propagation</code>：用于指定事务的传播行为。默认值是REQUIRED，表示一定会有事务，增删改的选择。查询方法可以选择SUPPORTS。</li><li><code>read-only</code>：用于指定事务是否只读。只有查询方法才能设置为true。默认值是false，表示读写。</li><li><code>timeout</code>：用于指定事务的超时时间，默认值是-1，表示永不超时。如果指定了数值，以秒为单位。</li><li><code>rollback-for</code>：用于指定一个异常，当产生该异常时，事务回滚，产生其他异常时，事务不回滚。没有默认值。不配置此属性，表示任何异常都回滚。</li><li><code>no-rollback-for</code>：用于指定一个异常，当产生该异常时，事务不回滚，产生其他异常时事务回滚。没有默认值。不配置此属性，表示任何异常都回滚。</li></ul></li></ul><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 配置事务的通知--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>txAdvice<span class="token punctuation">"</span></span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- 二者优先级 find* 范围小，优先级高 find开头的一般是查询方法，所以配置read-only为true--></span>

        <span class="token comment" spellcheck="true">&lt;!-- * 表示都能匹配上--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>REQUIRED<span class="token punctuation">"</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- find* 表示只能find开头的方法能匹配上--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>find*<span class="token punctuation">"</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>SUPPORTS<span class="token punctuation">"</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>method</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>项目示例：<a href="https://gitee.com/sky03/Spring_tx_XML" target="_blank" rel="noopener">AOP的事务配置基于XML</a></p></li></ol><h3 id="基于注解"><a href="#基于注解" class="headerlink" title="基于注解"></a>基于注解</h3><ol><li><p>用注解首先要配置要扫描的包</p><pre class="line-numbers language-xml"><code class="language-xml"> <span class="token comment" spellcheck="true">&lt;!-- 配置spring创建容器时要扫描的包--></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xyz.sky03<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">context:</span>component-scan</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>再用注解配置Service和Dao、还有JdbcTemplate和DataSource</p><blockquote><p>因为 <code>JdbcDaoSupport</code>使用注解会很不方便，所以自己配置JdbcTemplate的bean，再注入DataSource</p></blockquote><p>在Dao实现类上用 <code>@Autowired</code> 对JdbcTemplate注入</p><pre class="line-numbers language-xml"><code class="language-xml"> <span class="token comment" spellcheck="true">&lt;!-- 配置JdbcTemplate--></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jdbcTemplate<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.springframework.jdbc.core.JdbcTemplate<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

 <span class="token comment" spellcheck="true">&lt;!--配置数据源的bean--></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.springframework.jdbc.datasource.DriverManagerDataSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jdbc:mysql:///eesy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>driverClassName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.mysql.jdbc.Driver<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>admin<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置事务管理器</p><pre class="line-numbers language-xml"><code class="language-xml"> <span class="token comment" spellcheck="true">&lt;!-- 配置事务管理器 --></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>开启Spring对注解事务的支持</p><pre class="line-numbers language-xml"><code class="language-xml"> <span class="token comment" spellcheck="true">&lt;!-- 开启spring对注解事务的支持--></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>annotation-driven</span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>annotation-driven</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>在需要事务支持的地方使用<code>@Transactional</code>注解</p><ul><li>该注解使用位置：类名上方</li><li>一般用在Service实现类</li><li>属性：跟<code>&lt;tx:method&gt;</code> 标签的属性一样</li><li>细节：在类的上方配置 <code>@Transactional(propagation= Propagation.SUPPORTS,readOnly=true)</code> ，表示该类中的所有方法都是只读型事务，那增删改的方法就需要单独配置读写型事务<ul><li>在方法的上方加上 <code>@Transactional(propagation= Propagation.REQUIRED,readOnly=false)</code> 该优先级大于类上方的配置</li></ul></li></ul></li><li><p>所以注解的方法的缺点很明显，需要在每个业务类或者增删改的方法上加注解，XML文件方式则可以一劳永逸。</p></li><li><p>因为因为已经在事务类和方法上加了事务注解，所以不需要切入点了</p></li><li><p>项目示例：<a href="https://gitee.com/sky03/Spring_tx_anno" target="_blank" rel="noopener">AOP的事务配置基于注解</a></p></li></ol><h3 id="纯注解"><a href="#纯注解" class="headerlink" title="纯注解"></a>纯注解</h3><ol><li><p>创建配置类。在上一个基于注解的基础上，在config包中创建一个配置类<code>SpringConfiguration</code>，在该类上加 <code>@Configuration</code>注解，表示该类为配置类；当配置类作为<code>AnnotationConfigApplicationContext</code>对象创建的参数时，该注解可以不写。</p></li><li><p>配置要扫描的包。在<code>SpringConfiguration</code> 类的上方加<code>@ComponentScan(&quot;xyz.sky03&quot;)</code> 。</p></li><li><p>创建数据库配置类。在config包中创建<code>JdbcConfig</code>类，用于配置JdbcTemplate和DataSource。</p><p>示例：</p><pre class="line-numbers language-java"><code class="language-java"> <span class="token keyword">package</span> config<span class="token punctuation">;</span>

 <span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
 <span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span>
 <span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>core<span class="token punctuation">.</span>JdbcTemplate<span class="token punctuation">;</span>
 <span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>DriverManagerDataSource<span class="token punctuation">;</span>

 <span class="token keyword">import</span> javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>DataSource<span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">/**
 * 和连接数据库相关的配置类
 */</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcConfig</span> <span class="token punctuation">{</span>

     <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${jdbc.driver}"</span><span class="token punctuation">)</span>
     <span class="token keyword">private</span> String driver<span class="token punctuation">;</span>

     <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${jdbc.url}"</span><span class="token punctuation">)</span>
     <span class="token keyword">private</span> String url<span class="token punctuation">;</span>

     <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${jdbc.username}"</span><span class="token punctuation">)</span>
     <span class="token keyword">private</span> String username<span class="token punctuation">;</span>

     <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${jdbc.password}"</span><span class="token punctuation">)</span>
     <span class="token keyword">private</span> String password<span class="token punctuation">;</span>

     <span class="token comment" spellcheck="true">/**
     * 创建JdbcTemplate
     * @param dataSource
     * @return
     */</span>
     <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"jdbcTemplate"</span><span class="token punctuation">)</span>
     <span class="token keyword">public</span> JdbcTemplate <span class="token function">createJdbcTemplate</span><span class="token punctuation">(</span>DataSource dataSource<span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTemplate</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token comment" spellcheck="true">/**
     * 创建数据源对象
     * @return
     */</span>
     <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"dataSource"</span><span class="token punctuation">)</span>
     <span class="token keyword">public</span> DataSource <span class="token function">createDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         DriverManagerDataSource ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DriverManagerDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         ds<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>
         ds<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
         ds<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
         ds<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> ds<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>在配置类上导入数据库配置类。加上<code>@Import({JdbcConfig.class})</code> 注解，导入数据库配置类。</p></li><li><p>配置数据库连接信息文件。在resource中创建<code>jdbcConfig.properties</code> 文件，用于配置数据库连接信息。</p><p>示例：</p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name"> jdbc.driver</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span>
<span class="token attr-name"> jdbc.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql:///eesy</span>
<span class="token attr-name"> jdbc.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name"> jdbc.password</span><span class="token punctuation">=</span><span class="token attr-value">admin</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>加载数据库连接文件。在配置类上加<code>@PropertySource(&quot;jdbcConfig.properties&quot;)</code> 注解，加载数据库连接的信息。</p></li><li><p>开启Spring对注解事务的支持。在配置类上加 <code>@EnableTransactionManagement</code>。</p></li><li><p>配置事务管理器。在config包中创建 <code>TransactionConfig</code>类</p><p>示例：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> config<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>DataSourceTransactionManager<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>PlatformTransactionManager<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>DataSource<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
* 和事务相关的配置类
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionConfig</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">/**
    * 用于创建事务管理器对象
    * @param dataSource
    * @return
    */</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"transactionManager"</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">//PlatformTransactionManager是一个接口</span>

    <span class="token keyword">public</span> PlatformTransactionManager <span class="token function">createTransactionManager</span><span class="token punctuation">(</span>DataSource dataSource<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>导入 <code>TransactionConfig</code>类。在配置类上加入 <code>@Import({JdbcConfig.class,TransactionConfig.class})</code> 注解。</p></li><li><p>在测试类上加入 <code>@ContextConfiguration(classes= SpringConfiguration.class)</code> 注解。注意：属性为classes。</p></li><li><p>项目示例：<a href="https://gitee.com/sky03/Spring_tx_withoutXML" target="_blank" rel="noopener">Spring纯注解的事务配置</a></p></li></ol><h2 id="AOP的编程式事务"><a href="#AOP的编程式事务" class="headerlink" title="AOP的编程式事务"></a>AOP的编程式事务</h2><p>编程式事务太麻烦，有过多重复代码，一般不推介使用。</p></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者:</i></span> <span class="reprint-info"><a href="https://blog.sky03.cn" rel="external nofollow noreferrer">Sky03</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接:</i></span> <span class="reprint-info"><a href="https://blog.sky03.cn/2019/18155.html">https://blog.sky03.cn/2019/18155.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明:</i></span> <span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.sky03.cn" target="_blank">Sky03</a> !</span></div></div><script async defer>document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/Java/"><span class="chip bg-color">Java</span></a> <a href="/tags/Spring/"><span class="chip bg-color">Spring</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="/libs/share/css/share.min.css"><div id="article-share"></div></div></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.4rem;line-height:38px}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22ab38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019fe8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="/medias/loading.gif" data-original="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="/medias/loading.gif" data-original="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><style>.valine-card{margin:1.5rem auto}.valine-card .card-content{padding:20px 20px 5px 20px}#vcomments textarea{box-sizing:border-box;background:url(/medias/comment_bg.png) 100% 100% no-repeat}#vcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem}#vcomments blockquote p{text-indent:.2rem}#vcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#vcomments img{max-width:100%;height:auto;cursor:pointer}#vcomments ol li{list-style-type:decimal}#vcomments ol,ul{display:block;padding-left:2em;word-spacing:.05rem}#vcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#vcomments ul li{list-style-type:disc}#vcomments ul ul li{list-style-type:circle}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#vcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#vcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#vcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#vcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#vcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#vcomments h6{font-size:1rem;line-height:1.3rem}#vcomments p{font-size:1rem;line-height:1.5rem}#vcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#vcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#vcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#vcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#vcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#vcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#vcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#vcomments b,strong{font-weight:700}#vcomments dfn{font-style:italic}#vcomments small{font-size:85%}#vcomments cite{font-style:normal}#vcomments mark{background-color:#fcf8e3;padding:.2em}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}</style><div class="card valine-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="vcomments" class="card-content" style="display:grid"></div></div><script src="/libs/valine/av-min.js"></script><script src="/libs/valine/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"MASaMNWJl3iWNi4ujnjp623B-gzGzoHsz",appKey:"qMFRjvcHiM5EC9rKjFNWnOY4",notify:!1,verify:!1,visitor:!0,avatar:"monsterid",pageSize:"10",lang:"zh-cn",placeholder:"给你个喷我的机会..."})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i> &nbsp;上一篇</div><div class="card"><a href="/2019/38653.html"><div class="card-image"><img src="/medias/loading.gif" data-original="/medias/featureimages/16.jpg" class="responsive-img" alt="Junit测试"> <span class="card-title">Junit测试</span></div></a><div class="card-content article-content"><div class="summary block-with-text">Junit单元测试 测试分类： 黑盒测试：不需要写代码，给输入值，看程序是否能够输出期望的值 白盒测试：需要写代码，关注程序具体的执行流程 Junit使用：白盒测试 步骤： 定义一个测试类（测试用例） 建议命名规则： 测试类名：</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2019-02-17</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Java/" class="post-category">Java</a></span></div></div><div class="card-action article-tags"><a href="/tags/Java基础/"><span class="chip bg-color">Java基础</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/2019/41331.html"><div class="card-image"><img src="/medias/loading.gif" data-original="/medias/featureimages/7.jpg" class="responsive-img" alt="Java之泛型"> <span class="card-title">Java之泛型</span></div></a><div class="card-content article-content"><div class="summary block-with-text">集合中的泛型 在List中可以添加任意类型对象，因为参数是Object为了限制类型的添加，这时候就需要泛型(jdk1.5后支持) 泛型的用法是在容器后面添加&lt;Type&gt;Type可以是类，抽象类，接口泛型表示这种容器，只能存放该</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2019-02-12</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Java/" class="post-category">Java</a></span></div></div><div class="card-action article-tags"><a href="/tags/Java基础/"><span class="chip bg-color">Java基础</span></a></div></div></div></div></article></div><script>$('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: Sky03's Blog<br />'
            + '文章作者: Sky03<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });</script><script src="/libs/codeBlock/codeBlockFuction.js"></script><script src="/libs/codeBlock/codeLang.js"></script><script src="/libs/codeBlock/codeCopy.js"></script><script src="/libs/codeBlock/codeShrink.js"></script><style>code[class*=language-],pre[class*=language-]{white-space:pre!important}</style></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="/libs/tocbot/tocbot.min.js"></script><script>$(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });</script></main><footer class="page-footer bg-color"><div class="container row center-align"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">年份</span> &nbsp;by&nbsp; <a href="https://blog.sky03.cn" target="_blank">Sky03</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">71.3k</span>&nbsp;字 <span id="busuanzi_container_site_pv">|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span>&nbsp;次</span> <span id="busuanzi_container_site_uv">|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span>&nbsp;人</span><br><span id="sitetime">载入运行时间...</span><script>function siteTime(){window.setTimeout("siteTime()",1e3);var e=36e5,t=24*e,n=new Date,o="2018",i=n.getFullYear(),r=n.getMonth()+1,a=n.getDate(),m=n.getHours(),l=n.getMinutes(),M=n.getSeconds(),d=Date.UTC(o,"11","12","0","0","0"),g=Date.UTC(i,r,a,m,l,M)-d,s=Math.floor(g/31536e6),T=Math.floor(g/t-365*s),u=Math.floor((g-(365*s+T)*t)/e),c=Math.floor((g-(365*s+T)*t-u*e)/6e4),f=Math.floor((g-(365*s+T)*t-u*e-6e4*c)/1e3);o==i?(document.getElementById("year").innerHTML=i,document.getElementById("sitetime").innerHTML="本站已勉强运行 "+T+" 天 "+u+" 小时 "+c+" 分钟 "+f+" 秒"):(document.getElementById("year").innerHTML=o+" - "+i,document.getElementById("sitetime").innerHTML="本站已勉强运行 "+s+" 年 "+T+" 天 "+u+" 小时 "+c+" 分钟 "+f+" 秒")}setInterval(siteTime,1e3)</script><br></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/skyls03" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i></a><a href="mailto:skyls03@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=946523579" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 946523579" data-position="top" data-delay="50"><i class="fab fa-qq"></i></a> <a href="https://www.zhihu.com/people/liu-lang-de-feng-zhu/activities" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/liu-lang-de-feng-zhu/activities" data-position="top" data-delay="50"><i class="fab fa-zhihu1">知</i></a><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script src="/js/search.js"></script><script>$(function(){searchFunc("/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="/libs/materialize/materialize.min.js"></script><script src="/libs/masonry/masonry.pkgd.min.js"></script><script src="/libs/aos/aos.js"></script><script src="/libs/scrollprogress/scrollProgress.min.js"></script><script src="/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?02ee3ea6dba8039d1ecb21d3d6f253cb";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/libs/others/clicklove.js" async></script><script async src="/libs/others/busuanzi.pure.mini.js"></script><script src="/libs/background/ribbon-dynamic.js" async></script><script src="/libs/instantpage/instantpage.js" type="module"></script><script>window.$crisp=[],window.CRISP_WEBSITE_ID="ace4111a-6f1a-4fb2-9ff3-e96a20275ac8",d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)</script><script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)0<=(t=c[r].getBoundingClientRect()).top&&0<=t.left&&t.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n()},e.src=i}();var t}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this)</script></body></html>